<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>برنامج الصيانة المنزلية - جمعية اعتدال وإسعاد</title>
    <!-- تحميل Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- تحميل مكتبات React و ReactDOM -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- تحميل Babel لتحويل JSX في المتصفح -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- خطوط وتنسيقات الطباعة -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Alexandria:wght@400;500;600;700;800;900&display=swap');
        * { font-family: 'Alexandria', sans-serif !important; }

        /* تنسيقات خاصة بالطباعة (لحفظ PDF) */
        @media print {
            .no-print, .close-button { display: none !important; }
            body { 
                -webkit-print-color-adjust: exact; 
                print-color-adjust: exact; 
                background-color: white !important; 
                height: auto !important;
                overflow: visible !important;
            }
            #root, .min-h-screen { 
                height: auto !important; 
                overflow: visible !important; 
                min-height: 0 !important;
            }
            .shadow-2xl, .shadow-lg, .shadow-sm { box-shadow: none !important; border: 1px solid #ddd; }
            .break-inside-avoid { page-break-inside: avoid; break-inside: avoid; }
        }
    </style>
</head>
<body class="bg-gray-100">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo } = React;

        // ===================================================================
        // === مكونات الأيقونات (SVG) ===
        // ===================================================================

        // المكون الأساسي للأيقونة (SVG)
        const SvgIcon = ({ path, size = 24, className = "", fill = "none", stroke = "currentColor", strokeWidth = "2" }) => (
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width={size}
                height={size}
                viewBox="0 0 24 24"
                fill={fill}
                stroke={stroke}
                strokeWidth={strokeWidth}
                strokeLinecap="round"
                strokeLinejoin="round"
                className={className}
            >
                {path}
            </svg>
        );
        
        // أيقونات مساعدة
        const IconChevronLeft = ({ size = 24, className = "" }) => <SvgIcon size={size} className={className} path={<path d="m15 18-6-6 6-6" />} />;
        const IconX = ({ size = 24, className = "" }) => <SvgIcon size={size} className={className} path={<path d="M18 6 6 18M6 6l12 12" />} />;
        const IconTrendingUp = ({ size = 16, className = "" }) => <SvgIcon size={size} className={className} path={<><polyline points="22 7 13.5 15.5 8.5 10.5 2 17" /><polyline points="16 7 22 7 22 13" /></>} />;
        const IconBanknote = ({ size = 16, className = "" }) => <SvgIcon size={size} className={className} path={<><rect width="20" height="12" x="2" y="6" rx="3" /><circle cx="12" cy="12" r="2" /><path d="M6 12h.01M18 12h.01" /></>} />;
        const IconZap = ({ size = 16, className = "" }) => <SvgIcon size={size} className={className} path={<polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2" />} />;
        const IconDroplet = ({ size = 16, className = "" }) => <SvgIcon size={size} className={className} path={<path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.32 0z" />} />;
        const IconWrench = ({ size = 32, className = "" }) => <SvgIcon size={size} className={className} path={<path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-5.65 5.65a1 1 0 0 1-1.42-1.42l5.66-5.66a6 6 0 0 1 7.94-7.94l-3.77 3.77z" />} />;
        const IconHome = ({ size = 32, className = "" }) => <SvgIcon size={size} className={className} path={<><path d="M9 21v-6a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2v6" /><path d="M12 3l7 7v11a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V10z" /></>} />;
        const IconUsers = ({ size = 32, className = "" }) => <SvgIcon size={size} className={className} path={<><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2" /><circle cx="9" cy="7" r="4" /><path d="M22 21v-2a4 4 0 0 0-3-3.87" /><path d="M16 3.13a4 4 0 0 1 0 7.75" /></>} />;
        const IconUser = ({ size = 20, className = "" }) => <SvgIcon size={size} className={className} path={<><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></>} />;
        const IconPrinter = ({ size = 20, className = "" }) => <SvgIcon size={size} className={className} path={<><polyline points="6 9 6 2 18 2 18 9" /><path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2" /><rect width="12" height="8" x="6" y="14" /></>} />;

        // ===================================================================
        // === نهاية مكونات الأيقونات ===
        // ===================================================================
        
        // === ثوابت جمعية إسعاد ===
        const MAINTENANCE_COST = 1733; 
        const NUMBER_OF_FAMILIES = 6; 

        // بيانات المستفيدين والخدمات
        const beneficiariesData = [
          {
            id: 1,
            name: 'سهام فرج',
            cost: 411,
            services: [
              { type: 'تصليح نشافة', system: 'كهرباء', location: 'غرفة الغسيل' } // 1
            ]
          },
          {
            id: 2,
            name: 'اشواق علي هزازي',
            cost: 197,
            services: [
              { type: 'تغيير سخان', system: 'سباكة/كهرباء', location: 'الحمام' }, // 2
              { type: 'تغيير هوز (عدد 2)', system: 'سباكة', location: 'الحمام' }, // 3
              { type: 'تغيير محبس (عدد 2)', system: 'سباكة', location: 'الحمام' } // 4
            ]
          },
          {
            id: 3,
            name: 'شمعة علي عايش',
            cost: 194,
            services: [
              { type: 'تركيب سخان مع المواد (عدد 2)', system: 'سباكة/كهرباء', location: 'الحمام والمطبخ' } // 5
            ]
          },
          {
            id: 4,
            name: 'نوره عيد الخالدي',
            cost: 303,
            services: [
              { type: 'فك وتركيب كرسي جديد', system: 'سباكة', location: 'الحمام' }, // 6
              { type: 'تركيب مروحة شفاط مع المواد', system: 'كهرباء', location: 'الحمام' }, // 7
              { type: 'تركيب سماعة دش', system: 'سباكة', location: 'الحمام' } // 8
            ]
          },
          {
            id: 5,
            name: 'ابتسام ناصر المحسن',
            cost: 528,
            services: [
              { type: 'تركيب مروحة شفاط (عدد 3)', system: 'كهرباء', location: 'المنزل' }, // 9
              { type: 'تركيب سخان حمام ومطبخ (عدد 2)', system: 'سباكة/كهرباء', location: 'المرافق' }, // 10
              { type: 'تركيب إنارة سبوت لايت (عدد 10)', system: 'كهرباء', location: 'الأسقف' } // 11
            ]
          },
          {
            id: 6,
            name: 'عبد الله علي الشريط',
            cost: 100,
            services: [
              { type: 'تركيب سخان', system: 'سباكة/كهرباء', location: 'الحمام' } // 12
            ]
          }
        ];

        const TOTAL_ISSUES_COUNT = 16; 

        // لوحة الألوان
        const COLORS = {
          PRIMARY: '#003866', 
          ACCENT: '#ff6b00', 
          SECONDARY_ACCENT: '#2f7e99', 
          LIGHT_GREEN: '#6cb499', 
          TAUPE: '#baa88d', 
          SLATE_GRAY: '#5b6670', 

          TOTAL_CARD: {
            // تم تحديث الألوان هنا لتكون برتقالية
            FROM: '#ff6b00', 
            TO: '#cc5500',   
            BORDER: '#ff6b00'
          },
          FAMILY_CARD: { 
            FROM: '#003866', 
            TO: '#2f7e99',    
            BORDER: '#003866'
          },
          DAILY_CARD: {
            BORDER: 'border-[#6cb499]', 
            BG_FROM: 'from-[#f0f9f5]',
            BG_TO: 'to-[#e5f3ed]'
          },
          MONTHLY_CARD: {
            BORDER: 'border-[#baa88d]', 
            BG_FROM: 'from-[#fcfaf7]',
            BG_TO: 'to-[#f8f5f0]'
          },
          ANNUAL_CARD: {
            BORDER: 'border-[#5b6670]', 
            BG_FROM: 'from-[#f7f8f8]',
            BG_TO: 'to-[#f0f2f4]'
          },
          DETAIL_MODAL_BG: 'from-[#003866] to-[#2f7e99]', 
        };

        function IsadMaintenanceDashboard() {
          const [showTotalIssues, setShowTotalIssues] = useState(false);

          // البيانات
          const maintenanceData = {
            total: {
              title: 'عدد الأعطال التي تم صيانتها إجماليًا',
              count: TOTAL_ISSUES_COUNT, 
              // استخدام الألوان البرتقالية المحدّثة من COLORS.TOTAL_CARD
              color: `from-[${COLORS.TOTAL_CARD.FROM}] to-[${COLORS.TOTAL_CARD.TO}]`,
            },
            daily: {
              title: 'التوفير اليومي', 
              waterSaved: 880, 
              kiloWatt: 7,     
              stateSaving: 8,  
              beneficiarySaving: 3, 
              color: COLORS.DAILY_CARD.BORDER,
              bgColor: COLORS.DETAIL_MODAL_BG, 
            },
            monthly: {
              title: 'التوفير الشهري', 
              waterSaved: 26400, 
              kiloWatt: 210,     
              stateSaving: 239,  
              beneficiarySaving: 97, 
              color: COLORS.MONTHLY_CARD.BORDER,
              bgColor: COLORS.DETAIL_MODAL_BG,
            },
            annual: {
              title: 'التوفير السنوي', 
              waterSaved: 321200, 
              kiloWatt: 2555,     
              stateSaving: 2911,  
              beneficiarySaving: 1183, 
              color: COLORS.ANNUAL_CARD.BORDER,
              bgColor: COLORS.DETAIL_MODAL_BG,
            },
          };
          
          const totalSavingValue = useMemo(() => {
            // إجمالي التوفير (SR) من جميع الفترات
            return (maintenanceData.daily.stateSaving + maintenanceData.daily.beneficiarySaving) + 
                   (maintenanceData.monthly.stateSaving + maintenanceData.monthly.beneficiarySaving) +
                   (maintenanceData.annual.stateSaving + maintenanceData.annual.beneficiarySaving);
          }, [maintenanceData]);

          const roiValue = useMemo(() => {
              // حساب العائد الاستثماري
              if (MAINTENANCE_COST === 0) return 0;
              return ((totalSavingValue - MAINTENANCE_COST) / MAINTENANCE_COST) * 100;
          }, [totalSavingValue]);

          const benefitPerSAR = useMemo(() => {
            // حساب المنافع لكل ريال
            if (MAINTENANCE_COST === 0) return 0;
            return totalSavingValue / MAINTENANCE_COST;
          }, [totalSavingValue]);
          
          const cardOrder = ['daily', 'monthly', 'annual'];


          const StatCard = ({ category, data }) => {
            let cardBgClasses = 'bg-white';
            if (category === 'daily') cardBgClasses = `bg-gradient-to-br ${COLORS.DAILY_CARD.BG_FROM} ${COLORS.DAILY_CARD.BG_TO}`;
            else if (category === 'monthly') cardBgClasses = `bg-gradient-to-br ${COLORS.MONTHLY_CARD.BG_FROM} ${COLORS.MONTHLY_CARD.BG_TO}`;
            else if (category === 'annual') cardBgClasses = `bg-gradient-to-br ${COLORS.ANNUAL_CARD.BG_FROM} ${COLORS.ANNUAL_CARD.BG_TO}`;
            
            return (
              <div
                className={`${cardBgClasses} rounded-xl shadow-lg p-6 transition-all duration-300 border-r-4 ${data.color} break-inside-avoid`}
              >
                <div className="text-right mb-4">
                  <p className="text-base text-gray-700 mb-3 font-semibold flex items-center justify-between">
                    <span className="text-lg font-bold text-gray-800">{data.title}</span>
                    <span className="flex items-center space-x-1 space-x-reverse">
                      <IconBanknote size={18} className={`text-[${COLORS.PRIMARY}]`} /> 
                      <IconZap size={18} className={`text-[${COLORS.PRIMARY}]`} />
                      <IconDroplet size={18} className={`text-[${COLORS.PRIMARY}]`} />
                    </span>
                  </p>
                </div>

                <div className="space-y-3 pt-3 border-t border-gray-300">
                  <div className="bg-white rounded-lg p-3 border-l-4 border-[${COLORS.ACCENT}] shadow-sm">
                    <p className="text-xs text-gray-700 mb-1 font-medium flex justify-between items-center">
                      <span>لترات الماء الموفرة</span>
                      <IconDroplet size={16} className={`text-[${COLORS.ACCENT}]`} />
                    </p>
                    <p className="text-xl font-bold text-gray-900">{data.waterSaved.toLocaleString()} <span className="text-sm font-normal text-gray-500 mr-1">لتر</span></p>
                  </div>

                  <div className="bg-white rounded-lg p-3 border-l-4 border-[${COLORS.LIGHT_GREEN}] shadow-sm">
                    <p className="text-xs text-gray-700 mb-1 font-medium flex justify-between items-center">
                      <span>الكيلو / واط الموفرة</span>
                      <IconZap size={16} className={`text-[${COLORS.LIGHT_GREEN}]`} />
                    </p>
                    <p className="text-xl font-bold text-gray-900">{data.kiloWatt.toLocaleString()} <span className="text-sm font-normal text-gray-500 mr-1">ك.واط</span></p>
                  </div>
                  
                  <div className="bg-white rounded-lg p-3 border-l-4 border-[${COLORS.TAUPE}] shadow-sm">
                    <p className="text-xs text-gray-700 mb-1 font-medium flex justify-between items-center">
                      <span>(SR) القيمة التي تم توفيرها للدولة</span>
                      <IconTrendingUp size={16} className={`text-[${COLORS.TAUPE}]`} />
                    </p>
                    <p className="text-xl font-bold text-gray-900">SAR {data.stateSaving.toLocaleString()}</p>
                  </div>

                  <div className="bg-white rounded-lg p-3 border-l-4 border-[${COLORS.SLATE_GRAY}] shadow-sm">
                    <p className="text-xs text-gray-700 mb-1 font-medium flex justify-between items-center">
                      <span>(SR) القيمة التي تم توفيرها للمستفيد</span>
                      <IconBanknote size={16} className={`text-[${COLORS.SLATE_GRAY}]`} />
                    </p>
                    <p className="text-xl font-bold text-gray-900">SAR {data.beneficiarySaving.toLocaleString()}</p>
                  </div>
                </div>
              </div>
            );
          };

          // مكون لعرض بطاقة المستفيد الواحد
          const BeneficiaryCard = ({ beneficiary }) => (
            <div className="bg-white border-2 border-gray-200 rounded-xl p-0 hover:shadow-xl transition-all overflow-hidden mb-4 break-inside-avoid">
                {/* رأس البطاقة: اسم المستفيد */}
                <div className={`bg-gray-50 p-4 border-b border-gray-200 flex items-center justify-between`}>
                    <div className="flex items-center gap-3">
                        <div className={`bg-[${COLORS.SECONDARY_ACCENT}] p-2 rounded-full text-white`}>
                            <IconUser size={20} />
                        </div>
                        <h3 className="font-bold text-lg text-gray-800">{beneficiary.name}</h3>
                    </div>
                    {/* التكلفة (اختياري عرضها) */}
                    <div className="bg-white px-3 py-1 rounded-lg border border-gray-300 text-sm font-semibold text-gray-600">
                        التكلفة: {beneficiary.cost} SAR
                    </div>
                </div>
                
                {/* قائمة الخدمات لهذا المستفيد */}
                <div className="p-4 bg-white">
                    <div className="space-y-3">
                        {beneficiary.services.map((service, idx) => (
                            <div key={idx} className="flex items-start gap-3 p-2 rounded-lg hover:bg-gray-50 transition-colors">
                                <div className="mt-1">
                                     <IconWrench size={16} className={`text-[${COLORS.ACCENT}]`} />
                                </div>
                                <div>
                                    <p className="font-bold text-gray-800 text-sm">{service.type}</p>
                                    <p className="text-xs text-gray-500 mt-0.5">{service.system} | {service.location}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
          );


          const GeneralDetailModal = ({ isOpen, onClose, title, totalCount }) => {
            if (!isOpen) return null;

            return (
              <div className="fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4 print:hidden">
                <div className="bg-white rounded-2xl shadow-2xl max-w-4xl w-full max-h-[95vh] overflow-hidden">
                  <div className={`bg-gradient-to-r ${COLORS.DETAIL_MODAL_BG} p-6 text-white flex justify-between items-center sticky top-0 z-10`}>
                    <button
                      onClick={onClose}
                      className="hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition close-button"
                    >
                      <IconX size={24} />
                    </button>
                    <div>
                         <h2 className="text-2xl font-bold text-right">سجل الصيانات المنفذة</h2>
                         <p className="text-sm text-gray-200 text-right mt-1">تفاصيل الخدمات المقدمة لكل مستفيد (إجمالي {totalCount} عطل)</p>
                    </div>
                  </div>

                  <div className="p-6 overflow-y-auto max-h-[calc(95vh-88px)] bg-gray-50">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                      {beneficiariesData.map((beneficiary) => (
                        <BeneficiaryCard key={beneficiary.id} beneficiary={beneficiary} />
                      ))}
                    </div>
                  </div>
                </div>
              </div>
            );
          };

          const FamiliesCard = () => (
            <div 
                className={`bg-gradient-to-r from-[${COLORS.FAMILY_CARD.FROM}] to-[${COLORS.FAMILY_CARD.TO}] rounded-2xl shadow-2xl p-10 text-center text-white border-4 border-[${COLORS.FAMILY_CARD.BORDER}] break-inside-avoid`}
            >
                <p className="text-3xl font-bold mb-4">عدد الأسر المستفيدة من الصيانة</p>
                <p className="text-7xl font-black mb-4">{NUMBER_OF_FAMILIES}</p>
                <div className="flex items-center justify-center gap-3 mt-4">
                    <IconHome size={32} className="text-white" />
                    <IconUsers size={32} className="text-white" />
                </div>
            </div>
          );


          return (
            <div className="min-h-screen bg-gray-100 p-6 print:bg-white print:p-0" dir="rtl">

              <div className="max-w-7xl mx-auto print:max-w-none">
                <div className={`bg-gradient-to-r from-[${COLORS.PRIMARY}] to-[${COLORS.SECONDARY_ACCENT}] rounded-2xl shadow-2xl p-10 mb-8 text-white border-b-8 border-[${COLORS.ACCENT}] relative`}>
                  
                  <div className="flex items-center justify-between">
                    <div className="text-right flex-1 min-w-0 pr-4 md:pr-10"> 
                      <h1 className="text-4xl md:text-5xl font-black mb-3">برنامج الصيانة المنزلية - تنفيذ جمعية اعتدال</h1>
                      <p className="text-gray-200 text-xl md:text-2xl font-bold">ملخص نتائج التوفير وصيانة الأعطال للأسر المستفيدة لجمعية إسعاد</p>
                    </div>
                    
                    <div className="flex-shrink-0">
                      <div className="bg-white bg-opacity-25 p-5 rounded-full">
                        <IconWrench size={56} className="text-white" /> 
                      </div>
                    </div>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <FamiliesCard />

                    <div 
                      onClick={() => setShowTotalIssues(true)} 
                      // تم تحديث فئة الخلفية هنا لاستخدام الألوان البرتقالية المحدثة
                      className={`bg-gradient-to-r ${maintenanceData.total.color} rounded-2xl shadow-2xl p-10 text-center text-white transform hover:scale-[1.01] transition-all duration-300 border-4 border-[${COLORS.ACCENT}] cursor-pointer hover:shadow-2xl break-inside-avoid`}
                    >
                      <p className="text-3xl font-bold mb-4">{maintenanceData.total.title}</p>
                      <p className="text-7xl font-black mb-4">{maintenanceData.total.count}</p>
                      <div className="flex items-center justify-center gap-3 mt-4">
                        <IconWrench size={32} className="text-white animate-pulse" />
                      </div>
                    </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                  {cardOrder.map(key => (
                    <StatCard 
                        key={key} 
                        category={key} 
                        data={maintenanceData[key]} 
                    />
                  ))}
                </div>

                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 break-inside-avoid"> 
                  
                  <div className="bg-white rounded-xl shadow-lg p-6 border-r-4 border-[${COLORS.PRIMARY}] break-inside-avoid flex flex-col justify-between">
                    <h3 className="text-xl font-bold text-gray-900 mb-5 text-right">إجمالي القيمة التي تم توفيرها (للدولة والمستفيد)</h3>
                    <div className={`bg-gradient-to-r from-[${COLORS.PRIMARY}] to-[${COLORS.SECONDARY_ACCENT}] rounded-xl p-8 lg:p-10 text-center text-white shadow-lg flex flex-col justify-center items-center h-full`}>
                      <p className="text-5xl lg:text-6xl font-black">SAR {totalSavingValue.toLocaleString()}</p>
                      <p className="text-lg mt-3 font-medium">مقارنة بتكلفة {MAINTENANCE_COST.toLocaleString()} SAR</p>
                    </div>
                  </div>

                  <div className="bg-white rounded-xl shadow-lg p-6 border-r-4 border-[${COLORS.ACCENT}] break-inside-avoid flex flex-col justify-between">
                    <h3 className="text-xl font-bold text-gray-900 mb-5 text-right">العائد الاستثماري (ROI)</h3>
                    <div className={`bg-gradient-to-r from-[${COLORS.ACCENT}] to-[#cc5500] rounded-xl p-8 lg:p-10 text-center text-white shadow-lg flex flex-col justify-center items-center h-full`}>
                      <p className="text-5xl lg:text-6xl font-black mb-3">{roiValue.toFixed(2)}%</p>
                      <p className="text-lg mt-2 font-medium">أي أن كل 1 ريال صُرف على المشروع أعاد {benefitPerSAR.toFixed(2)} ريال من المنافع</p>
                    </div>
                  </div>
                </div>

                <div className="mt-8 bg-white rounded-xl shadow-lg p-6 text-center border-2 border-gray-200 no-print">
                  <p className="text-gray-700 flex items-center justify-center gap-3 text-lg font-semibold">
                    <IconChevronLeft size={24} className={`text-[${COLORS.ACCENT}]`} />
                    <span>انقر على بطاقة **عدد الأعطال التي تم صيانتها إجماليًا** لعرض تفاصيل الصيانة لكل مستفيد.</span>
                  </p>
                </div>
              </div>

              <GeneralDetailModal 
                isOpen={showTotalIssues} 
                onClose={() => setShowTotalIssues(false)}
                title={maintenanceData.total.title}
                totalCount={maintenanceData.total.count}
              />
              
            </div>
          );
        }

        // تشغيل تطبيق React في العنصر الجذر
        const rootElement = document.getElementById('root');
        ReactDOM.createRoot(rootElement).render(<IsadMaintenanceDashboard />);
    </script>
</body>
</html>